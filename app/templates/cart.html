{% extends "base.html" %}
{% block content %}
  <div class="d-flex flex-wrap align-items-end justify-content-between gap-2 mb-3">
    <div>
      <h2 class="fw-semibold mb-0">Корзина</h2>
      <div class="text-muted">Проверка выбранных товаров перед оформлением заказа</div>
    </div>

    {% if items %}
      <form method="post" action="{{ url_for('shop.cart_clear') }}">
        <button type="submit" class="btn btn-outline-secondary">
          Очистить корзину
        </button>
      </form>
    {% endif %}
  </div>

  {% if items %}
    <div class="bg-white border rounded-3 shadow-sm">
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Товар</th>
              <th class="text-center" style="width: 140px;">Количество</th>
              <th class="text-end" style="width: 140px;">Цена</th>
              <th class="text-end" style="width: 160px;">Сумма</th>
              <th class="text-end" style="width: 120px;">Действие</th>
            </tr>
          </thead>
          <tbody>
            {% for item in items %}
              <tr>
                <td>
                  <div class="fw-semibold">{{ item.product.name }}</div>
                  <div class="text-muted small">{{ item.product.category.name }}</div>
                </td>
                <td class="text-center">
                  <span class="badge text-bg-secondary">{{ item.qty }}</span>
                </td>
                <td class="text-end">
                  {{ "%.2f"|format(item.unit_price) }} ₽
                </td>
                <td class="text-end">
                  <span class="fw-semibold">{{ "%.2f"|format(item.line_total) }} ₽</span>
                </td>
                <td class="text-end">
                  <form
                    method="post"
                    action="{{ url_for('shop.cart_remove', product_id=item.product.id) }}"
                  >
                    <button type="submit" class="btn btn-sm btn-outline-danger">
                      Удалить
                    </button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="row g-3 mt-3">
      <div class="col-md-7">
        <div class="bg-white border rounded-3 shadow-sm p-4">
          <h5 class="fw-semibold mb-2">Информация</h5>
          <div class="text-muted">
            Оформление заказа выполняется через одну форму с указанием контактных данных.
            Онлайн-оплата и интеграции с доставкой не реализуются в рамках курсовой работы.
          </div>
        </div>
      </div>

      <div class="col-md-5">
        <div class="bg-white border rounded-3 shadow-sm p-4 h-100">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="text-muted">Итого</div>
            <div class="fs-5 fw-semibold">{{ "%.2f"|format(total) }} ₽</div>
          </div>

          <div class="d-grid gap-2 mt-3">
            <a class="btn btn-success btn-lg" href="{{ url_for('shop.checkout') }}">
              Перейти к оформлению
            </a>
            <a class="btn btn-outline-secondary" href="{{ url_for('shop.catalog') }}">
              Продолжить покупки
            </a>
          </div>

          <div class="mt-3 small text-muted">
            Корзина хранится в сессии браузера.
          </div>
        </div>
      </div>
    </div>
  {% else %}
    <div class="alert alert-info">
      Корзина пуста. Перейдите в каталог и добавьте товары.
    </div>
    <a class="btn btn-primary" href="{{ url_for('shop.catalog') }}">
      Перейти в каталог
    </a>
  {% endif %}
{% endblock %}
