{% extends "base.html" %}
{% block content %}
  <div class="row mb-3">
    <div class="col-md-8">
      <h2 class="fw-semibold mb-0">Каталог товаров</h2>
      <div class="text-muted">Футбольная атрибутика и аксессуары</div>
    </div>
    <div class="col-md-4">
      <form method="get" class="d-flex gap-2">
        <input
          type="text"
          name="q"
          class="form-control"
          placeholder="Поиск"
          value="{{ q }}"
        />
        <button class="btn btn-outline-secondary" type="submit">Найти</button>
      </form>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col">
      <div class="d-flex flex-wrap gap-2">
        <a
          class="btn btn-sm {% if not category_slug %}btn-primary{% else %}btn-outline-primary{% endif %}"
          href="{{ url_for('shop.catalog', q=q) }}"
        >
          Все категории
        </a>
        {% for category in categories %}
          <a
            class="btn btn-sm {% if category.slug == category_slug %}btn-primary{% else %}btn-outline-primary{% endif %}"
            href="{{ url_for('shop.catalog', category=category.slug, q=q) }}"
          >
            {{ category.name }}
          </a>
        {% endfor %}
      </div>
    </div>
  </div>

  {% if products %}
    <div class="row g-3">
      {% for product in products %}
        <div class="col-sm-6 col-md-4 col-lg-3">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              <div class="fw-semibold mb-1">{{ product.name }}</div>
              <div class="text-muted small mb-2">
                {{ product.category.name }}
              </div>

              <div class="mb-3 text-muted small">
                {{ product.description or "Описание отсутствует." }}
              </div>

              <div class="mt-auto">
                <div class="fw-semibold mb-2">
                  {{ "%.2f"|format(product.price) }} ₽
                </div>

                <div class="d-flex gap-2">
                  <a
                    href="{{ url_for('shop.product', slug=product.slug) }}"
                    class="btn btn-sm btn-outline-secondary w-100"
                  >
                    Подробнее
                  </a>

                  <form
                    method="post"
                    action="{{ url_for('shop.cart_add', product_id=product.id) }}"
                  >
                    <input type="hidden" name="qty" value="1" />
                    <button class="btn btn-sm btn-primary" type="submit">
                      В корзину
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info">
      Товары не найдены.
    </div>
  {% endif %}
{% endblock %}
